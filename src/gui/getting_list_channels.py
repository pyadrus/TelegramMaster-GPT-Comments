import flet as ft
from loguru import logger

from src.core.configs import config
from src.gui.base_application import BaseApplication


class RadyAndBackButtons:
    """–ö–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥ –∏ –Ω–∞—á–∞—Ç—å"""

    def __init__(self, page: ft.Page, info_list: ft.ListView):
        self.page = page  # —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        self.info_list = info_list  # ListView –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞

    def create_buttons(self) -> list:
        """–°–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫."""
        return [
            ft.OutlinedButton(
                text="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤",
                on_click=lambda _: self.page.go("/getting_list_channels"),
                width=config.BUTTON_WIDTH_RadyAndBackButtons,
                height=config.BUTTON_HEIGHT_RadyAndBackButtons,
                style=ft.ButtonStyle(shape=ft.RoundedRectangleBorder(radius=config.RADIUS)),
            ),
        ]

    def build(self) -> ft.Column:
        """–°–æ–∑–¥–∞–µ—Ç –∫–æ–ª–æ–Ω–∫—É —Å –∫–Ω–æ–ø–∫–∞–º–∏."""
        buttons = self.create_buttons()
        return ft.Column(
            [*buttons],
            alignment=ft.MainAxisAlignment.START,
            spacing=config.SPACING,
        )


class ApplicationGettingListChannels(BaseApplication):
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. üìã –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤"""

    def create_buttons(self) -> list:
        """–°–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫."""
        return [
            ft.OutlinedButton(
                text="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤",
                on_click=lambda _: self.page.go("/getting_list_channels"),
                width=config.BUTTON_WIDTH_RadyAndBackButtons,
                height=config.BUTTON_HEIGHT_RadyAndBackButtons,
                style=ft.ButtonStyle(shape=ft.RoundedRectangleBorder(radius=config.RADIUS)),
            ),
        ]

    async def route_change(self, route):
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞."""
        await super().route_change(route)

        if self.page.route == "/getting_list_channels":  # üìã –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
            logger.info("–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤")
            # –û—á–∏—â–∞–µ–º info_list –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            self.info_list.controls.clear()
            self.info_list.controls.append(
                ft.Text(
                    "–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤\n\n"
                )
            )
        elif self.page.route == "/":  # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            logger.info("–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞")
            # –û—á–∏—â–∞–µ–º info_list –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            self.info_list.controls.clear()
            self.info_list.controls.append(
                ft.Text(
                    "TelegramMaster Commentator üöÄ\n\nTelegramMaster Commentator - —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π "
                    "—Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∫–∞–Ω–∞–ª–∞—Ö Telegram, –∞ —Ç–∞–∫–∂–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏. üí¨\n\n"
                    "üìÇ –ü—Ä–æ–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ GitHub: https://github.com/pyadrus/TelegramMaster_Commentator \n"
                    "üì≤ –ö–æ–Ω—Ç–∞–∫—Ç —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –≤ Telegram: https://t.me/PyAdminRU\n"
                    f"üì° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –∫–∞–Ω–∞–ª–µ: https://t.me/master_tg_d"
                )
            )

        self.page.update()